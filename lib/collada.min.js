var COLLADA;(function(e){(function(e){var t=function(){function e(){}return e.forEachChild=function(e,t){var n=e.childNodes,r=n.length;for(var i=0;i<r;i++){var s=n[i];if(s.nodeType!==1)continue;t(s)}},e}();e.Utils=t})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},COLLADA;(function(e){(function(e){var t=function(){function e(){this.target=null}return e.prototype.getUrl=function(){throw new Error("not implemented")},e.prototype.resolve=function(e){throw new Error("not implemented")},e}();e.Link=t;var n=function(e){function t(t){e.call(this),this.url=t.trim().replace(/^#/,"")}return __extends(t,e),t.prototype.getUrl=function(){return this.url},t.prototype.resolve=function(e){var t=e.ids[this.url];t!=null?this.target=t:e.log.write("Could not find URL target with URL "+this.url,3)},t}(t);e.UrlLink=n;var r=function(e){function t(t,n){e.call(this),this.url=t,this.scope=n}return __extends(t,e),t.prototype.getUrl=function(){return this.url},t.prototype.resolve=function(e){var t=this.scope,n=null;while(n==null&&t!=null)n=t.fxChildren[this.url],t=t.fxParent;n!=null?this.target=n:e.log.write("Could not find FX target with URL "+this.url,3)},t}(t);e.FxLink=r;var i=function(e){function t(t,n){e.call(this),this._parseUrl=function(){var e=this.url.split("/");this.id=e.shift(),this.id==="."&&(this.id=this.parentId);while(e.length>1)this.sids.push(e.shift());if(e.length>0){var t=e[0],n=t.indexOf(".")>=0,r=t.indexOf("(")>=0;if(n)e=t.split("."),this.sids.push(e.shift()),this.member=e.shift(),this.dotSyntax=!0;else if(r){var i=t.split("(");this.sids.push(i.shift()),this.indices=[];var s;for(var o=0,u=i.length;o<u;o++)s=i[o],this.indices.push(parseInt(s.replace(/\)/,""),10));this.arrSyntax=!0}else this.sids.push(t)}},this.url=t,this.id=null,this.parentId=n,this.sids=[],this.member=null,this.indices=[],this.dotSyntax=!1,this.arrSyntax=!1,this._parseUrl()}return __extends(t,e),t.prototype.getUrl=function(){return this.url},t.findSidTarget=function(e,t,n,r){if(t==null)return r.log.write("Could not resolve SID target "+n.join("/")+", missing root element",3),null;var i=t,s=null;for(var o=0,u=n.length;o<u;o++){var a=n[o],f=[i];while(f.length!==0){var l=f.shift();if(l.sid===a){s=l;break}var c=l.sidChildren;if(c!=null)for(var h=0,p=c.length;h<p;h++){var d=c[h];f.push(d)}}if(s==null)return r.log.write("Could not resolve SID target "+n.join("/")+", missing SID part "+a,3),null;i=s}return s},t.prototype.resolve=function(e){var n=null;if(this.id==null){e.log.write("Could not resolve SID #"+this.url+", link has no root ID",3);return}n=e.ids[this.id];if(n==null){e.log.write("Could not resolve SID #"+this.url+", could not find root element "+this.id,3);return}this.target=t.findSidTarget(this.url,n,this.sids,e)},t}(t);e.SidLink=i})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.name=null,this.id=null,this.sid=null,this.fxParent=null,this.fxChildren={},this.sidChildren=[]}return t.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Element,"COLLADA.Loader.Element",n)},t._fromLink=function(e,t,n,r){return e===null?null:e.target===null?null:e.target instanceof t?e.target:(r.log.write("Link with url "+e.getUrl()+" does not point to a "+n+", link target ignored",4),null)},t}();t.Element=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.log=null,this.ids={},this.links=[],this.totalBytes=null,this.loadedBytes=null}return t.prototype.getAttributeAsFloat=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?parseFloat(i.value):r?(this.log.write("Element "+e.nodeName+" is missing required float attribute "+t+". Using default value "+n+".",4),n):n},t.prototype.getAttributeAsInt=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?parseInt(i.value,10):r?(this.log.write("Element "+e.nodeName+" is missing required integer attribute "+t+". Using default value "+n+".",4),n):n},t.prototype.getAttributeAsString=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?i.value:r?(this.log.write("Element "+e.nodeName+" is missing required string attribute "+t+". Using default value "+n+".",4),n):n},t.prototype.createUrlLink=function(t){var n=new e.Loader.UrlLink(t);return this.links.push(n),n},t.prototype.createSidLink=function(t,n){var r=new e.Loader.SidLink(t,n);return this.links.push(r),r},t.prototype.createFxLink=function(t,n){var r=new e.Loader.FxLink(t,n);return this.links.push(r),r},t.prototype.getAttributeAsUrlLink=function(e,t,n){var r=e.attributes.getNamedItem(t);return r!=null?this.createUrlLink(r.value):n?(this.log.write("Element "+e.nodeName+" is missing required URL link attribute "+t+".",4),null):null},t.prototype.getAttributeAsSidLink=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?this.createSidLink(i.value,n):r?(this.log.write("Element "+e.nodeName+" is missing required SID link attribute "+t+".",4),null):null},t.prototype.getAttributeAsFxLink=function(e,t,n,r){var i=e.attributes.getNamedItem(t);return i!=null?this.createFxLink(i.value,n):r?(this.log.write("Element "+e.nodeName+" is missing required FX link attribute "+t+".",4),null):null},t.prototype.strToStrings=function(e){return e.length>0?e.trim().split(/\s+/):[]},t.prototype.strToFloats=function(e){var t=this.strToStrings(e),n=new Float32Array(t.length),r=t.length;for(var i=0;i<r;++i)n[i]=parseFloat(t[i]);return n},t.prototype.strToInts=function(e){var t=this.strToStrings(e),n=new Int32Array(t.length),r=t.length;for(var i=0;i<r;++i)n[i]=parseInt(t[i],10);return n},t.prototype.strToBools=function(e){var t=this.strToStrings(e),n=new Uint8Array(t.length),r=t.length;for(var i=0;i<r;++i)n[i]=t[i]==="true"||t[i]==="1"?1:0;return n},t.prototype.strToColor=function(e){var t=this.strToFloats(e);return t.length===4?t:(this.log.write("Skipped color element because it does not contain 4 numbers",4),null)},t.prototype.registerUrlTarget=function(e,t){var n=e.id;if(n==null){t&&this.log.write("Object has no ID, object was not registered as a URL target.",4);return}if(this.ids[n]!=null){this.log.write("There is already an object with ID "+n+". IDs must be globally unique.",4);return}this.ids[n]=e},t.prototype.registerFxTarget=function(e,t){var n=e.sid;if(n==null){this.log.write("Cannot add a FX target: object has no SID.",4);return}if(t.fxChildren[n]!=null){this.log.write("There is already an FX target with SID "+n+".",4);return}e.fxParent=t,t.fxChildren[n]=e},t.prototype.registerSidTarget=function(e,t){t.sidChildren.push(e)},t.prototype.getNodePath=function(e){var t="<"+e.nodeName+">",n=1,r=10;while(e.parentNode!=null){e=e.parentNode;if(e.nodeName.toUpperCase()==="COLLADA")break;if(n>=r){t=".../"+t;break}t="<"+e.nodeName+">/"+t,n+=1}return t},t.prototype.reportUnexpectedChild=function(e){this.log.write("Skipped unexpected element "+this.getNodePath(e)+".",3)},t.prototype.reportUnhandledChild=function(e){this.log.write("Element "+this.getNodePath(e)+" is legal, but not handled by this loader.",3)},t.prototype.resolveAllLinks=function(){var e=this.links.length;for(var t=0;t<e;++t){var n=this.links[t];n.resolve(this)}},t}();t.Context=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.children=[]}return t.parse=function(t,n,r,i){var s=new e.Loader.Library;return e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case r:s.children.push(n(e,i));break;case"extra":i.reportUnhandledChild(e);break;default:i.reportUnexpectedChild(e)}}),s},t}();t.Library=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.unit=null,this.upAxis=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Asset;return e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"unit":r.unit=n.getAttributeAsFloat(e,"meter",1,!1);break;case"up_axis":r.upAxis=e.textContent.toUpperCase().charAt(0);break;case"contributor":case"created":case"modified":case"revision":case"title":case"subject":case"keywords":n.reportUnhandledChild(e);break;default:n.reportUnexpectedChild(e)}}),r},n}(e.Loader.Element);t.Asset=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.instance=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Scene;return e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"instance_visual_scene":r.instance=n.getAttributeAsUrlLink(e,"url",!0);break;default:n.reportUnexpectedChild(e)}}),r},n}(e.Loader.Element);t.Scene=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.type=null,this.initFrom=null,this.format=null,this.size=null,this.viewportRatio=null,this.mipLevels=null,this.mipmapGenerate=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.EffectSurface,"COLLADA.Loader.EffectSurface",n)},n.parse=function(t,n,r){var i=new e.Loader.EffectSurface;return i.type=r.getAttributeAsString(t,"type",null,!0),e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"init_from":i.initFrom=r.createUrlLink(e.textContent);break;case"format":i.format=e.textContent;break;case"size":i.size=r.strToFloats(e.textContent);break;case"viewport_ratio":i.viewportRatio=r.strToFloats(e.textContent);break;case"mip_levels":i.mipLevels=parseInt(e.textContent,10);break;case"mipmap_generate":i.mipmapGenerate=e.textContent==="True";break;default:r.reportUnexpectedChild(e)}}),i},n}(e.Loader.Element);t.EffectSurface=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.surface=null,this.image=null,this.wrapS=null,this.wrapT=null,this.minFilter=null,this.magFilter=null,this.borderColor=null,this.mipmapMaxLevel=null,this.mipmapBias=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.EffectSampler,"COLLADA.Loader.EffectSampler",n)},n.parse=function(t,n,r){var i=new e.Loader.EffectSampler;return e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"source":i.surface=r.createFxLink(e.textContent,n);break;case"instance_image":i.image=r.getAttributeAsUrlLink(e,"url",!0);break;case"wrap_s":i.wrapS=e.textContent;break;case"wrap_t":i.wrapT=e.textContent;break;case"minfilter":i.minFilter=e.textContent;break;case"magfilter":i.magFilter=e.textContent;break;case"border_color":i.borderColor=r.strToFloats(e.textContent);break;case"mipmap_maxlevel":i.mipmapMaxLevel=parseInt(e.textContent,10);break;case"mipmap_bias":i.mipmapBias=parseFloat(e.textContent);break;default:r.reportUnexpectedChild(e)}}),i},n}(e.Loader.Element);t.EffectSampler=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.semantic=null,this.surface=null,this.sampler=null,this.floats=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.EffectParam,"COLLADA.Loader.EffectParam",n)},n.parse=function(t,n,r){var i=new e.Loader.EffectParam;return i.sid=r.getAttributeAsString(t,"sid",null,!1),r.registerFxTarget(i,n),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"semantic":i.semantic=t.textContent;break;case"float":i.floats=r.strToFloats(t.textContent);break;case"float2":i.floats=r.strToFloats(t.textContent);break;case"float3":i.floats=r.strToFloats(t.textContent);break;case"float4":i.floats=r.strToFloats(t.textContent);break;case"surface":i.surface=e.Loader.EffectSurface.parse(t,i,r);break;case"sampler2D":i.sampler=e.Loader.EffectSampler.parse(t,i,r);break;default:r.reportUnexpectedChild(t)}}),i},n}(e.Loader.Element);t.EffectParam=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.color=null,this.textureSampler=null,this.texcoord=null,this.opaque=null,this.bumptype=null}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.ColorOrTexture;return i.opaque=r.getAttributeAsString(t,"opaque",null,!1),i.bumptype=r.getAttributeAsString(t,"bumptype",null,!1),e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"color":i.color=r.strToColor(e.textContent);break;case"texture":i.textureSampler=r.getAttributeAsFxLink(e,"texture",n,!0),i.texcoord=r.getAttributeAsString(e,"texcoord",null,!0);break;default:r.reportUnexpectedChild(e)}}),i},n}(e.Loader.Element);t.ColorOrTexture=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.params=[],this.shading=null,this.emission=null,this.ambient=null,this.diffuse=null,this.specular=null,this.reflective=null,this.transparent=null,this.bump=null,this.shininess=null,this.transparency=null,this.reflectivity=null,this.index_of_refraction=null,this.double_sided=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.EffectTechnique,"COLLADA.Loader.EffectTechnique",n)},n.parse=function(t,n,r){var i=new e.Loader.EffectTechnique;return i.sid=r.getAttributeAsString(t,"sid",null,!1),r.registerFxTarget(i,n),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"blinn":case"phong":case"lambert":case"constant":i.shading=t.nodeName,e.Loader.EffectTechnique.parseParam(t,i,"COMMON",r);break;case"extra":e.Loader.EffectTechnique.parseExtra(t,i,r);break;default:r.reportUnexpectedChild(t)}}),i},n.parseParam=function(t,n,r,i){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"newparam":n.params.push(e.Loader.EffectParam.parse(t,n,i));break;case"emission":n.emission=e.Loader.ColorOrTexture.parse(t,n,i);break;case"ambient":n.ambient=e.Loader.ColorOrTexture.parse(t,n,i);break;case"diffuse":n.diffuse=e.Loader.ColorOrTexture.parse(t,n,i);break;case"specular":n.specular=e.Loader.ColorOrTexture.parse(t,n,i);break;case"reflective":n.reflective=e.Loader.ColorOrTexture.parse(t,n,i);break;case"transparent":n.transparent=e.Loader.ColorOrTexture.parse(t,n,i);break;case"bump":n.bump=e.Loader.ColorOrTexture.parse(t,n,i);break;case"shininess":n.shininess=parseFloat(t.childNodes[1].textContent);break;case"reflectivity":n.reflectivity=parseFloat(t.childNodes[1].textContent);break;case"transparency":n.transparency=parseFloat(t.childNodes[1].textContent);break;case"index_of_refraction":n.index_of_refraction=parseFloat(t.childNodes[1].textContent);break;case"double_sided":n.double_sided=parseFloat(t.textContent)>0;break;default:r==="COMMON"&&i.reportUnexpectedChild(t)}})},n.parseExtra=function(t,n,r){if(n==null){r.log.write("Ignored element <extra>, because there is no <technique>.",3);return}e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"technique":var i=r.getAttributeAsString(t,"profile",null,!0);e.Loader.EffectTechnique.parseParam(t,n,i,r);break;default:r.reportUnexpectedChild(t)}})},n}(e.Loader.Element);t.EffectTechnique=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.params=[],this.technique=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Effect,"COLLADA.Loader.Effect",n)},n.parse=function(t,n){var r=new e.Loader.Effect;return r.id=n.getAttributeAsString(t,"id",null,!0),n.registerUrlTarget(r,!0),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"profile_COMMON":e.Loader.Effect.parseProfileCommon(t,r,n);break;case"profile":n.log.write("Skipped non-common effect profile for effect "+r.id+".",3);break;case"extra":e.Loader.EffectTechnique.parseExtra(t,r.technique,n);break;default:n.reportUnexpectedChild(t)}}),r},n.parseProfileCommon=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"newparam":n.params.push(e.Loader.EffectParam.parse(t,n,r));break;case"technique":n.technique=e.Loader.EffectTechnique.parse(t,n,r);break;case"extra":e.Loader.EffectTechnique.parseExtra(t,n.technique,r);break;default:r.reportUnexpectedChild(t)}})},n}(e.Loader.Element);t.Effect=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.effect=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Material,"COLLADA.Loader.Material",n)},n.parse=function(t,n){var r=new e.Loader.Material;return r.id=n.getAttributeAsString(t,"id",null,!0),r.name=n.getAttributeAsString(t,"name",null,!1),n.registerUrlTarget(r,!0),e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"instance_effect":r.effect=n.getAttributeAsUrlLink(e,"url",!0);break;default:n.reportUnexpectedChild(e)}}),r},n}(e.Loader.Element);t.Material=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.sourceId=null,this.count=null,this.stride=null,this.offset=null,this.data=null,this.params={}}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Source,"COLLADA.Loader.Source",n)},n.parse=function(t,n){var r=new e.Loader.Source;return r.id=n.getAttributeAsString(t,"id",null,!0),r.name=n.getAttributeAsString(t,"name",null,!1),n.registerUrlTarget(r,!0),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"bool_array":r.sourceId=n.getAttributeAsString(t,"id",null,!1),r.data=n.strToBools(t.textContent);break;case"float_array":r.sourceId=n.getAttributeAsString(t,"id",null,!1),r.data=n.strToFloats(t.textContent);break;case"int_array":r.sourceId=n.getAttributeAsString(t,"id",null,!1),r.data=n.strToInts(t.textContent);break;case"IDREF_array":case"Name_array":r.sourceId=n.getAttributeAsString(t,"id",null,!1),r.data=n.strToStrings(t.textContent);break;case"technique_common":e.Loader.Source.parseSourceTechniqueCommon(t,r,n);break;case"technique":n.reportUnhandledChild(t);break;default:n.reportUnexpectedChild(t)}}),r},n.parseSourceTechniqueCommon=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"accessor":e.Loader.Source.parseAccessor(t,n,r);break;default:r.reportUnexpectedChild(t)}})},n.parseAccessor=function(t,n,r){var i=r.getAttributeAsString(t,"source",null,!0);n.count=r.getAttributeAsInt(t,"count",0,!0),n.stride=r.getAttributeAsInt(t,"stride",1,!1),n.offset=r.getAttributeAsInt(t,"offset",0,!1),i!=="#"+n.sourceId&&r.log.write("Source "+n.id+"uses a non-local data source, this is not supported",4),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"param":e.Loader.Source.parseAccessorParam(t,n,r);break;default:r.reportUnexpectedChild(t)}})},n.parseAccessorParam=function(e,t,n){var r=n.getAttributeAsString(e,"name",null,!1),i=n.getAttributeAsString(e,"semantic",null,!1),s=n.getAttributeAsString(e,"type",null,!0),o=n.getAttributeAsString(e,"sid",null,!1);r!=null&&s!=null?t.params[r]=s:i!=null&&s!=null?t.params[i]=s:n.log.write("Accessor param for source "+t.id+" ignored due to missing type, name, or semantic",3)},n}(e.Loader.Element);t.Source=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.semantic=null,this.source=null,this.offset=null,this.set=null}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.Input;return i.semantic=r.getAttributeAsString(t,"semantic",null,!0),i.source=r.getAttributeAsUrlLink(t,"source",!0),n&&(i.offset=r.getAttributeAsInt(t,"offset",0,!0),i.set=r.getAttributeAsInt(t,"set",null,!1)),i},n}(e.Loader.Element);t.Input=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.type=null,this.count=null,this.material=null,this.inputs=[],this.indices=null,this.vcount=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Triangles;return r.name=n.getAttributeAsString(t,"name",null,!1),r.material=n.getAttributeAsString(t,"material",null,!1),r.count=n.getAttributeAsInt(t,"count",0,!0),r.type=t.nodeName,e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"input":r.inputs.push(e.Loader.Input.parse(t,!0,n));break;case"vcount":r.vcount=n.strToInts(t.textContent);break;case"p":r.indices=n.strToInts(t.textContent);break;default:n.reportUnexpectedChild(t)}}),r},n}(e.Loader.Element);t.Triangles=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.inputs=[]}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Vertices,"COLLADA.Loader.Vertices",n)},n.parse=function(t,n){var r=new e.Loader.Vertices;return r.id=n.getAttributeAsString(t,"id",null,!0),r.name=n.getAttributeAsString(t,"name",null,!1),n.registerUrlTarget(r,!0),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"input":r.inputs.push(e.Loader.Input.parse(t,!1,n));break;default:n.reportUnexpectedChild(t)}}),r},n}(e.Loader.Element);t.Vertices=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.sources=[],this.vertices=[],this.triangles=[]}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Geometry,"COLLADA.Loader.Geometry",n)},n.parse=function(t,n){var r=new e.Loader.Geometry;return r.id=n.getAttributeAsString(t,"id",null,!0),r.name=n.getAttributeAsString(t,"name",null,!1),n.registerUrlTarget(r,!0),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"mesh":e.Loader.Geometry.parseMesh(t,r,n);break;case"convex_mesh":case"spline":n.log.write("Geometry type "+t.nodeName+" not supported.",4);break;case"extra":e.Loader.Geometry.parseGeometryExtra(t,r,n);break;default:n.reportUnexpectedChild(t)}}),r},n.parseMesh=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"source":n.sources.push(e.Loader.Source.parse(t,r));break;case"vertices":n.vertices.push(e.Loader.Vertices.parse(t,r));break;case"triangles":case"polylist":case"polygons":n.triangles.push(e.Loader.Triangles.parse(t,r));break;case"lines":case"linestrips":case"trifans":case"tristrips":r.log.write("Geometry primitive type "+t.nodeName+" not supported.",4);break;default:r.reportUnexpectedChild(t)}})},n.parseGeometryExtra=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"technique":var i=r.getAttributeAsString(t,"profile",null,!0);e.Loader.Geometry.parseGeometryExtraTechnique(t,n,i,r);break;default:r.reportUnexpectedChild(t)}})},n.parseGeometryExtraTechnique=function(t,n,r,i){e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){default:i.reportUnhandledChild(e)}})},n}(e.Loader.Element);t.Geometry=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.joints=null,this.invBindMatrices=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Joints,i=[];return e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"input":var s=e.Loader.Input.parse(t,!1,n);e.Loader.Joints.addInput(r,s,n),i.push();break;default:n.reportUnexpectedChild(t)}}),r},n.addInput=function(e,t,n){switch(t.semantic){case"JOINT":e.joints=t;break;case"INV_BIND_MATRIX":e.invBindMatrices=t;break;default:n.log.write("Unknown joints input semantic "+t.semantic,4)}},n}(e.Loader.Element);t.Joints=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.inputs=[],this.vcount=null,this.v=null,this.joints=null,this.weights=null,this.count=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.VertexWeights;return r.count=n.getAttributeAsInt(t,"count",0,!0),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"input":var i=e.Loader.Input.parse(t,!0,n);e.Loader.VertexWeights.addInput(r,i,n);break;case"vcount":r.vcount=n.strToInts(t.textContent);break;case"v":r.v=n.strToInts(t.textContent);break;default:n.reportUnexpectedChild(t)}}),r},n.addInput=function(e,t,n){switch(t.semantic){case"JOINT":e.joints=t;break;case"WEIGHT":e.weights=t;break;default:n.log.write("Unknown vertex weights input semantic "+t.semantic,4)}},n}(e.Loader.Element);t.VertexWeights=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.source=null,this.bindShapeMatrix=null,this.sources=[],this.joints=null,this.vertexWeights=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Skin;return r.source=n.getAttributeAsUrlLink(t,"source",!0),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"bind_shape_matrix":r.bindShapeMatrix=n.strToFloats(t.textContent);break;case"source":r.sources.push(e.Loader.Source.parse(t,n));break;case"joints":r.joints=e.Loader.Joints.parse(t,n);break;case"vertex_weights":r.vertexWeights=e.Loader.VertexWeights.parse(t,n);break;default:n.reportUnexpectedChild(t)}}),r},n}(e.Loader.Element);t.Skin=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this)}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Morph;return n.log.write("Morph controllers not implemented",4),r},n}(e.Loader.Element);t.Morph=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.skin=null,this.morph=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Controller,"COLLADA.Loader.Controller",n)},n.parse=function(t,n){var r=new e.Loader.Controller;return r.id=n.getAttributeAsString(t,"id",null,!0),r.name=n.getAttributeAsString(t,"name",null,!1),n.registerUrlTarget(r,!0),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"skin":r.skin!=null&&n.log.write("Controller "+r.id+" has multiple skins",4),r.skin=e.Loader.Skin.parse(t,n);break;case"morph":r.morph!=null&&n.log.write("Controller "+r.id+" has multiple morphs",4),r.morph=e.Loader.Morph.parse(t,n);break;default:n.reportUnexpectedChild(t)}}),r},n}(e.Loader.Element);t.Controller=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.value=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.LightParam;return r.sid=n.getAttributeAsString(t,"sid",null,!1),r.name=t.nodeName,r.value=parseFloat(t.textContent),r},n}(e.Loader.Element);t.LightParam=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.type=null,this.color=null,this.params={}}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Light;return r.id=n.getAttributeAsString(t,"id",null,!0),r.name=n.getAttributeAsString(t,"name",null,!1),n.registerUrlTarget(r,!1),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"technique_common":e.Loader.Light.parseTechniqueCommon(t,r,n);break;case"extra":n.reportUnhandledChild(t);break;default:n.reportUnexpectedChild(t)}}),r},n.parseTechniqueCommon=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"ambient":case"directional":case"point":case"spot":e.Loader.Light.parseParams(t,n,"COMMON",r);break;default:r.reportUnexpectedChild(t)}})},n.parseParams=function(t,n,r,i){n.type=t.nodeName,e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"color":n.color=i.strToFloats(t.textContent);break;case"constant_attenuation":case"linear_attenuation":case"quadratic_attenuation":case"falloff_angle":case"falloff_exponent":var r=e.Loader.LightParam.parse(t,i);i.registerSidTarget(r,n),n.params[r.name]=r;break;default:i.reportUnexpectedChild(t)}})},n}(e.Loader.Element);t.Light=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.value=null}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.CameraParam;return r.sid=n.getAttributeAsString(t,"sid",null,!1),r.name=t.nodeName,r.value=parseFloat(t.textContent),r},n}(e.Loader.Element);t.CameraParam=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.type=null,this.params={}}return __extends(n,t),n.parse=function(t,n){var r=new e.Loader.Camera;return r.id=n.getAttributeAsString(t,"id",null,!0),r.name=n.getAttributeAsString(t,"name",null,!1),n.registerUrlTarget(r,!1),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"asset":n.reportUnhandledChild(t);break;case"optics":e.Loader.Camera.parseOptics(t,r,n);break;case"imager":n.reportUnhandledChild(t);break;case"extra":n.reportUnhandledChild(t);break;default:n.reportUnexpectedChild(t)}}),r},n.parseOptics=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"technique_common":e.Loader.Camera.parseTechniqueCommon(t,n,r);break;case"technique":r.reportUnhandledChild(t);break;case"extra":r.reportUnhandledChild(t);break;default:r.reportUnexpectedChild(t)}})},n.parseTechniqueCommon=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"orthographic":e.Loader.Camera.parseParams(t,n,r);break;case"perspective":e.Loader.Camera.parseParams(t,n,r);break;default:r.reportUnexpectedChild(t)}})},n.parseParams=function(t,n,r){n.type=t.nodeName,e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"xmag":case"ymag":case"xfov":case"yfov":case"aspect_ratio":case"znear":case"zfar":var i=e.Loader.CameraParam.parse(t,r);r.registerSidTarget(i,n),n.params[i.name]=i;break;case"extra":r.reportUnhandledChild(t);break;default:r.reportUnexpectedChild(t)}})},n}(e.Loader.Element);t.Camera=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.initFrom=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Image,"COLLADA.Loader.Image",n)},n.parse=function(t,n){var r=new e.Loader.Image;return r.id=n.getAttributeAsString(t,"id",null,!0),n.registerUrlTarget(r,!0),e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"init_from":r.initFrom=e.textContent;break;default:n.reportUnexpectedChild(e)}}),r},n}(e.Loader.Element);t.Image=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.camera=null}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.InstanceCamera;return i.camera=r.getAttributeAsUrlLink(t,"url",!0),i.sid=r.getAttributeAsString(t,"sid",null,!1),i.name=r.getAttributeAsString(t,"name",null,!1),r.registerSidTarget(i,n),e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"extra":r.reportUnhandledChild(e);break;default:r.reportUnexpectedChild(e)}}),i},n}(e.Loader.Element);t.InstanceCamera=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){}return t.parse=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"technique_common":e.Loader.BindMaterial.parseTechniqueCommon(t,n,r);break;default:r.reportUnexpectedChild(t)}})},t.parseTechniqueCommon=function(t,n,r){e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"instance_material":n.materials.push(e.Loader.InstanceMaterial.parse(t,n,r));break;default:r.reportUnexpectedChild(t)}})},t}();t.BindMaterial=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.material=null,this.symbol=null,this.params={},this.vertexInputs={}}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.InstanceMaterial;return i.symbol=r.getAttributeAsString(t,"symbol",null,!1),i.material=r.getAttributeAsUrlLink(t
,"target",!0),r.registerSidTarget(i,n),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"bind_vertex_input":e.Loader.InstanceMaterial.parseBindVertexInput(t,i,r);break;case"bind":e.Loader.InstanceMaterial.parseBind(t,i,r);break;default:r.reportUnexpectedChild(t)}}),i},n.parseBindVertexInput=function(e,t,n){var r=n.getAttributeAsString(e,"semantic",null,!0),i=n.getAttributeAsString(e,"input_semantic",null,!0),s=n.getAttributeAsInt(e,"input_set",null,!1);r!=null&&i!=null?t.vertexInputs[r]={inputSemantic:i,inputSet:s}:n.log.write("Skipped a material vertex binding because of missing semantics.",3)},n.parseBind=function(e,t,n){var r=n.getAttributeAsString(e,"semantic",null,!1),i=n.getAttributeAsSidLink(e,"target",null,!0);r!=null?t.params[r]={target:i}:n.log.write("Skipped a material uniform binding because of missing semantics.",3)},n}(e.Loader.Element);t.InstanceMaterial=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.controller=null,this.skeletons=[],this.materials=[]}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.InstanceController;return i.controller=r.getAttributeAsUrlLink(t,"url",!0),i.sid=r.getAttributeAsString(t,"sid",null,!1),i.name=r.getAttributeAsString(t,"name",null,!1),r.registerSidTarget(i,n),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"skeleton":i.skeletons.push(r.createUrlLink(t.textContent));break;case"bind_material":e.Loader.BindMaterial.parse(t,i,r);break;default:r.reportUnexpectedChild(t)}}),i},n}(e.Loader.Element);t.InstanceController=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.geometry=null,this.materials=[]}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.InstanceGeometry;return i.geometry=r.getAttributeAsUrlLink(t,"url",!0),i.sid=r.getAttributeAsString(t,"sid",null,!1),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"bind_material":e.Loader.BindMaterial.parse(t,i,r);break;default:r.reportUnexpectedChild(t)}}),i},n}(e.Loader.Element);t.InstanceGeometry=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.light=null}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.InstanceLight;return i.light=r.getAttributeAsUrlLink(t,"url",!0),i.sid=r.getAttributeAsString(t,"sid",null,!1),i.name=r.getAttributeAsString(t,"name",null,!1),r.registerSidTarget(i,n),e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){case"extra":r.reportUnhandledChild(e);break;default:r.reportUnexpectedChild(e)}}),i},n}(e.Loader.Element);t.InstanceLight=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.type=null,this.data=null}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.NodeTransform;i.sid=r.getAttributeAsString(t,"sid",null,!1),i.type=t.nodeName,r.registerSidTarget(i,n),i.data=r.strToFloats(t.textContent);var s=0;switch(i.type){case"matrix":s=16;break;case"rotate":s=4;break;case"translate":s=3;break;case"scale":s=3;break;case"skew":s=7;break;case"lookat":s=9;break;default:r.log.write("Unknown transformation type "+i.type+".",4)}return i.data.length!==s&&r.log.write("Wrong number of elements for transformation type '"+i.type+"': expected "+s+", found "+i.data.length,4),i},n}(e.Loader.Element);t.NodeTransform=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.type=null,this.layer=null,this.children=[],this.parent=null,this.transformations=[],this.geometries=[],this.controllers=[],this.lights=[],this.cameras=[]}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.VisualSceneNode,"COLLADA.Loader.VisualSceneNode",n)},n.registerParent=function(e,t,n){e.parent=t,n.registerSidTarget(e,t)},n.parse=function(t,n){var r=new e.Loader.VisualSceneNode;return r.id=n.getAttributeAsString(t,"id",null,!1),r.sid=n.getAttributeAsString(t,"sid",null,!1),r.name=n.getAttributeAsString(t,"name",null,!1),r.type=n.getAttributeAsString(t,"type",null,!1),r.layer=n.getAttributeAsString(t,"layer",null,!1),n.registerUrlTarget(r,!1),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"instance_geometry":r.geometries.push(e.Loader.InstanceGeometry.parse(t,r,n));break;case"instance_controller":r.controllers.push(e.Loader.InstanceController.parse(t,r,n));break;case"instance_light":r.lights.push(e.Loader.InstanceLight.parse(t,r,n));break;case"instance_camera":r.cameras.push(e.Loader.InstanceCamera.parse(t,r,n));break;case"matrix":case"rotate":case"translate":case"scale":r.transformations.push(e.Loader.NodeTransform.parse(t,r,n));break;case"node":var i=e.Loader.VisualSceneNode.parse(t,n);e.Loader.VisualSceneNode.registerParent(i,r,n),r.children.push(i);break;case"extra":n.reportUnhandledChild(t);break;default:n.reportUnexpectedChild(t)}}),r},n}(e.Loader.Element);t.VisualSceneNode=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.children=[]}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.VisualScene,"COLLADA.Loader.VisualScene",n)},n.parse=function(t,n){var r=new e.Loader.VisualScene;return r.id=n.getAttributeAsString(t,"id",null,!1),n.registerUrlTarget(r,!1),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"node":var i=e.Loader.VisualSceneNode.parse(t,n);e.Loader.VisualSceneNode.registerParent(i,r,n),r.children.push(i);break;default:n.reportUnexpectedChild(t)}}),r},n}(e.Loader.Element);t.VisualScene=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.input=null,this.outputs=[],this.inTangents=[],this.outTangents=[],this.interpolation=null}return __extends(n,t),n.fromLink=function(t,n){return e.Loader.Element._fromLink(t,e.Loader.Sampler,"COLLADA.Loader.Sampler",n)},n.parse=function(t,n){var r=new e.Loader.Sampler;return r.id=n.getAttributeAsString(t,"id",null,!1),n.registerUrlTarget(r,!1),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"input":var i=e.Loader.Input.parse(t,!1,n);e.Loader.Sampler.addInput(r,i,n);break;default:n.reportUnexpectedChild(t)}}),r},n.addInput=function(e,t,n){switch(t.semantic){case"INPUT":e.input=t;break;case"OUTPUT":e.outputs.push(t);break;case"INTERPOLATION":e.interpolation=t;break;case"IN_TANGENT":e.inTangents.push(t);break;case"OUT_TANGENT":e.outTangents.push(t);break;default:n.log.write("Unknown sampler input semantic "+t.semantic,4)}},n}(e.Loader.Element);t.Sampler=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.source=null,this.target=null}return __extends(n,t),n.parse=function(t,n,r){var i=new e.Loader.Channel;return i.source=r.getAttributeAsUrlLink(t,"source",!0),i.target=r.getAttributeAsSidLink(t,"target",n.id,!0),e.Loader.Utils.forEachChild(t,function(e){switch(e.nodeName){default:r.reportUnexpectedChild(e)}}),i},n}(e.Loader.Element);t.Channel=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(t){function n(){t.call(this),this.parent=null,this.children=[],this.sources=[],this.samplers=[],this.channels=[]}return __extends(n,t),n.prototype.root=function(){return this.parent!=null?this.parent.root():this},n.parse=function(t,n){var r=new e.Loader.Animation;return r.id=n.getAttributeAsString(t,"id",null,!1),r.name=n.getAttributeAsString(t,"name",null,!1),n.registerUrlTarget(r,!1),e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"animation":var i=e.Loader.Animation.parse(t,n);i.parent=r,r.children.push(i);break;case"source":r.sources.push(e.Loader.Source.parse(t,n));break;case"sampler":r.samplers.push(e.Loader.Sampler.parse(t,n));break;case"channel":r.channels.push(e.Loader.Channel.parse(t,r,n));break;default:n.reportUnexpectedChild(t)}}),r},n}(e.Loader.Element);t.Animation=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.scene=null,this.asset=null,this.libEffects=new e.Loader.Library,this.libMaterials=new e.Loader.Library,this.libGeometries=new e.Loader.Library,this.libControllers=new e.Loader.Library,this.libLights=new e.Loader.Library,this.libCameras=new e.Loader.Library,this.libImages=new e.Loader.Library,this.libVisualScenes=new e.Loader.Library,this.libAnimations=new e.Loader.Library,this.libNodes=new e.Loader.Library}return t.parse=function(t,n){var r=t.getElementsByTagName("COLLADA");if(r.length===0){n.log.write("Cannot parse document, no top level COLLADA element.",4);return}if(r.length>1){n.log.write("Cannot parse document, more than one top level COLLADA element.",4);return}return e.Loader.Document.parseCOLLADA(r[0],n)},t.parseCOLLADA=function(t,n){var r=new e.Loader.Document;return e.Loader.Utils.forEachChild(t,function(t){switch(t.nodeName){case"asset":r.asset=e.Loader.Asset.parse(t,n);break;case"scene":r.scene=e.Loader.Scene.parse(t,n);break;case"library_effects":r.libEffects=e.Loader.Library.parse(t,e.Loader.Effect.parse,"effect",n);break;case"library_materials":r.libMaterials=e.Loader.Library.parse(t,e.Loader.Material.parse,"material",n);break;case"library_geometries":r.libGeometries=e.Loader.Library.parse(t,e.Loader.Geometry.parse,"geometry",n);break;case"library_images":r.libImages=e.Loader.Library.parse(t,e.Loader.Image.parse,"image",n);break;case"library_visual_scenes":r.libVisualScenes=e.Loader.Library.parse(t,e.Loader.VisualScene.parse,"visual_scene",n);break;case"library_controllers":r.libControllers=e.Loader.Library.parse(t,e.Loader.Controller.parse,"controller",n);break;case"library_animations":r.libAnimations=e.Loader.Library.parse(t,e.Loader.Animation.parse,"animation",n);break;case"library_lights":r.libLights=e.Loader.Library.parse(t,e.Loader.Light.parse,"effect",n);break;case"library_cameras":r.libCameras=e.Loader.Library.parse(t,e.Loader.Camera.parse,"camera",n);break;case"library_nodes":r.libNodes=e.Loader.Library.parse(t,e.Loader.VisualSceneNode.parse,"node",n);break;default:this.reportUnexpectedChild(t)}}),r},t}();t.Document=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){function n(e){switch(e){case 1:return"TRACE";case 2:return"INFO";case 3:return"WARNING";case 4:return"ERROR";case 5:return"EXCEPTION";default:return"OTHER"}}(function(e){e[e.Trace=1]="Trace",e[e.Info=2]="Info",e[e.Warning=3]="Warning",e[e.Error=4]="Error",e[e.Exception=5]="Exception"})(e.LogLevel||(e.LogLevel={}));var t=e.LogLevel,r=function(){function e(){this.messages=[]}return e.prototype.write=function(e,t){this.messages.push({message:e,level:t})},e}();e.LogArray=r;var i=function(){function e(){}return e.prototype.write=function(e,t){console.log(n(t)+": "+e)},e}();e.LogConsole=i;var s=function(){function e(e){this.area=e}return e.prototype.write=function(e,t){var r=n(t)+": "+e;this.area.textContent+=r+"\n"},e}();e.LogTextArea=s})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.onFinished=null,this.onProgress=null,this.log=new e.LogConsole}return t.prototype._reportError=function(e,t){this.onFinished&&this.onFinished(e,null)},t.prototype._reportSuccess=function(e,t,n){this.onFinished&&this.onFinished(e,t)},t.prototype._reportProgress=function(e,t){this.onProgress&&this.onProgress(e,t.loadedBytes,t.totalBytes)},t.prototype.loadFromXML=function(t,n){var r=new e.Loader.Context;return r.log=this.log,this._loadFromXML(t,n,r)},t.prototype._loadFromXML=function(t,n,r){var i=null;try{i=e.Loader.Document.parse(n,r),r.resolveAllLinks()}catch(s){r.log.write(s.message,5),this._reportError(t,r)}return this._reportSuccess(t,i,r),i},t.prototype.loadFromURL=function(t,n){var r=new e.Loader.Context;r.log=this.log;var i=this;if(document!=null&&document.implementation!=null&&document.implementation.createDocument!=null){var s=new XMLHttpRequest;typeof s.overrideMimeType=="function"&&s.overrideMimeType("text/xml"),s.onreadystatechange=function(){if(s.readyState===4){if(s.status===0||s.status===200)if(s.responseXML){var o=e.Loader.Document.parse(s.responseXML,r);i._reportSuccess(t,o,r)}else r.log.write("Empty or non-existing file "+n+".",4),i._reportError(t,r)}else s.readyState===3&&(r.totalBytes>0||(r.totalBytes=parseInt(s.getResponseHeader("Content-Length"))),r.loadedBytes=s.responseText.length,i._reportProgress(t,r))},s.open("GET",n,!0),s.send(null)}else r.log.write("Don't know how to parse XML!",4),i._reportError(t,r)},t}();t.ColladaLoader=n})(e.Loader||(e.Loader={}));var t=e.Loader})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function e(){this.symbols={}}return e}();t.MaterialMap=n;var r=function(){function t(){this.name=null,this.diffuse=null,this.specular=null,this.normal=null}return t.createDefaultMaterial=function(t){var n=t.materials.findConverter(null);return n?n:(n=new e.Converter.Material,t.materials.register(null,n),n)},t.createMaterial=function(t,n){var r=e.Loader.Material.fromLink(t.material,n);if(r===null)return n.log.write("Material not found, material skipped.",3),e.Converter.Material.createDefaultMaterial(n);var i=e.Loader.Effect.fromLink(r.effect,n);if(i===null)return n.log.write("Material effect not found, using default material",3),e.Converter.Material.createDefaultMaterial(n);var s=i.technique;if(s===null)return n.log.write("Material effect not found, using default material",3),e.Converter.Material.createDefaultMaterial(n);(s.diffuse.color!==null||s.specular.color!==null)&&n.log.write("Material "+r.id+" contains constant colors, colors ignored",3);var o=n.materials.findConverter(r);return o?o:(o=new e.Converter.Material,o.name=r.id,o.diffuse=e.Converter.Texture.createTexture(s.diffuse,n),o.specular=e.Converter.Texture.createTexture(s.specular,n),o.normal=e.Converter.Texture.createTexture(s.bump,n),n.materials.register(r,o),o)},t.getMaterialMap=function(t,n){var r=new e.Converter.MaterialMap,i=0;for(var s=0;s<t.length;s++){var o=t[s],u=o.symbol;if(u===null){n.log.write("Material instance has no symbol, material skipped.",3);continue}if(r.symbols[u]!=null){n.log.write("Material symbol "+u+" used multiple times",4);continue}r.symbols[u]=e.Converter.Material.createMaterial(o,n)}return r},t}();t.Material=r})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){var t=function(){function e(){}return e.prototype.contructor=function(){},e.round=function(e,t){return t!==null?Math.round(e*Math.pow(10,t))/Math.pow(10,t):e},e.copyNumberArray=function(e,t,n){for(var r=0;r<n;++r)t[r]=e[r]},e.forEachElement=function(e,t,n,r){var i=e.length/t;for(var s=0;s<i;++s)r(e[s*t+n])},e.mat4Extract=function(e,t,n){for(var r=0;r<16;++r)n[r]=e[t*16+r];mat4.transpose(n,n)},e.decompose=function(e,t,n,r){var i=mat3.create();vec3.set(t,e[12],e[13],e[14]),mat3.normalFromMat4(i,e),quat.fromMat3(n,i),quat.normalize(n,n),n[3]=-n[3],r[0]=vec3.length(vec3.fromValues(e[0],e[1],e[2])),r[1]=vec3.length(vec3.fromValues(e[4],e[5],e[6])),r[2]=vec3.length(vec3.fromValues(e[8],e[9],e[10]))},e.bezier=function(e,t,n,r,i){if(i<0||i>1)throw new Error("Invalid Bezier parameter: "+i);return e*(1-i)*(1-i)*(1-i)+3*t*i*(1-i)*(1-i)+3*n*i*i*(1-i)+r*i*i*i},e.hermite=function(e,t,n,r,i){if(i<0||i>1)throw new Error("Invalid Hermite parameter: "+i);var s=i*i,o=s*i;return e*(2*o-3*s+1)+t*(o-2*s+i)+r*(-2*o+3*s)+n*(o-s)},e.bisect=function(e,t,n,r){var i=0,s=1,o=t(i),u=t(s);if(e<=o)return i;if(e>=u)return s;var a=.5*(i+s),f=t(a),l=0;while(Math.abs(f-e)>n){if(f<e)i=a;else{if(!(f>e))return a;s=a}a=.5*(i+s),f=t(a),++l;if(l>r)throw new Error("Too many iterations")}return a},e.TO_RADIANS=Math.PI/180,e}();e.MathUtils=t})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(e){var t=function(){function e(){}return e.reIndex=function(e,t,n,r,i,s,o,u,a,f){var l=Math.min(i,f),c=t.length,h=r,p=a;while(h<c){var d=t[h];h+=n;var v=o[p];p+=u;for(var m=0;m<l;++m)s[i*v+m]=e[f*d+m]}},e.compactIndices=function(e,t,n){var r=0,i=e.length/t,s=new Int32Array(i);for(var o=0;o<i;++o){var u=-1;for(var a=0;a<o;++a)if(e[a*t+n]===e[o*t+n]){u=a;break}s[o]=u,u!==-1&&r++}var f=new Int32Array(i),l=0;for(var o=0;o<i;++o){var u=s[o];u===-1?(f[o]=l,l++):f[o]=f[u]}return f},e.maxIndex=function(e){if(e===null)return null;var t=-1,n=e.length;for(var r=0;r<n;++r)e[r]>t&&(t=e[r]);return t},e.createFloatArray=function(e,t,n,r){if(e===null)return null;e.stride>n?r.log.write("Source data for "+t+" contains too many dimensions, "+(e.stride-n)+" dimensions will be ignored",3):e.stride<n&&r.log.write("Source data for "+t+" does not contain enough dimensions, "+(n-e.stride)+" dimensions will be zero",3);var i=e.offset,s=e.offset+e.count*e.stride;if(s>e.data.length)return r.log.write("Source for "+t+" tries to access too many elements, data ignored",3),null;if(e.data instanceof Float32Array){var o=e.data,u=new Float32Array(e.count*n);for(var a=i;a<s;a+=n)for(var f=0;f<n;++f)u[a-i+f]=o[a+f];return u}return r.log.write("Source for "+t+" does not contain floating point data, data ignored",3),null},e.createStringArray=function(e,t,n,r){if(e===null)return null;e.stride>n?r.log.write("Source data for "+t+" contains too many dimensions, "+(e.stride-n)+" dimensions will be ignored",3):e.stride<n&&r.log.write("Source data for "+t+" does not contain enough dimensions, "+(n-e.stride)+" dimensions will be zero",3);var i=e.offset,s=e.offset+e.count*e.stride;if(s>e.data.length)return r.log.write("Source for "+t+" tries to access too many elements, data ignored",3),null;if(e.data instanceof Array){var o=e.data,u=new Array(e.count*n);for(var a=i;a<s;a+=n)for(var f=0;f<n;++f)u[a-i+f]=o[a+f];return u}return r.log.write("Source for "+t+" does not contain string data, data ignored",3),null},e}();e.Utils=t})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(e){this.node=e,this.name=e.name,this.index=null,this.parent=null,this.attachedToSkin=!1,this.invBindMatrix=mat4.create()}return t.prototype.parentIndex=function(){return this.parent===null?-1:this.parent.index},t.prototype.depth=function(){return this.parent===null?0:this.parent.depth()+1},t.create=function(t){return new e.Converter.Bone(t)},t.findBoneNode=function(t,n,r){var i=null;for(var s=0;s<n.length;s++){var o=n[s],u=t.split("/");i=e.Loader.SidLink.findSidTarget(t,o,u,r);if(i!=null)break}return i instanceof e.Loader.VisualSceneNode?i:(r.log.write("Joint "+t+" does not point to a visual scene node, joint ignored",3),null)},t.findBoneParents=function(t,n){var r=0;while(r<t.length){var i=t[r];r+=1;for(var s=0;s<t.length;s++){var o=t[s];if(i.node.parent===o.node){i.parent=o;break}}i.node.parent!=null&&i.parent==null&&(i.parent=e.Converter.Bone.create(i.node.parent),t.push(i.parent))}},t.createSkinBones=function(t,n,r,i,s){var o=[];for(var u=0;u<t.length;u++){var a=t[u],f=e.Converter.Bone.findBoneNode(a,n,s);if(f===null)return s.log.write("Joint "+a+" not found for skeleton, no bones created",3),[];var l=s.nodes.findConverter(f);if(l===null)return s.log.write("Joint "+a+" not converted for skeleton, no bones created",3),[];var c=e.Converter.Bone.create(l);c.attachedToSkin=!0,e.MathUtils.mat4Extract(i,u,c.invBindMatrix),o.push(c)}return e.Converter.Bone.findBoneParents(o,s),e.Converter.Bone.updateIndices(o),o},t.updateIndices=function(e){for(var t=0;t<e.length;++t){var n=e[t];n.index=t}},t.sameBone=function(e,t){if(e.node!==t.node)return!1;for(var n=0;n<16;++n)if(e.invBindMatrix[n]!==t.invBindMatrix[n])return!1;return!0},t.appendBones=function(t,n){for(var r=0;r<n.length;++r){var i=n[r];e.Converter.Bone.appendBone(t,i)}e.Converter.Bone.updateIndices(t)},t.appendBone=function(t,n){var r=!1;for(var i=0;i<t.length;++i){var s=t[i];if(e.Converter.Bone.sameBone(s,n))return r=!0,s.attachedToSkin=s.attachedToSkin||n.attachedToSkin,s}return r||(t.push(n),n.parent!==null&&(n.parent=e.Converter.Bone.appendBone(t,n.parent))),n},t.getBoneIndexMap=function(t,n){var r=new Uint32Array(t.length);for(var i=0;i<t.length;++i){var s=t[i],o=-1;for(var u=0;u<n.length;++u){var a=n[u];if(e.Converter.Bone.sameBone(s,a)){o=u;break}}if(o<0){var f=s.name,l=n.map(function(e){return e.name});throw new Error("Bone "+f+" not found in "+l)}r[i]=o}return r},t}();t.Bone=n})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function e(){this.name=null,this.vertexCount=null,this.indices=null,this.position=null,this.normal=null,this.texcoord=null,this.boneweight=null,this.boneindex=null,this.bbox_max=vec3.create(),this.bbox_min=vec3.create(),this.bindShapeMatrix=null,this._colladaVertexIndices=null,this._colladaIndexStride=null,this._colladaIndexOffset=null}return e}();t.GeometryChunk=n;var r=function(){function t(){this.name="",this.chunks=[],this.bones=[]}return t.createStatic=function(t,n){var r=e.Loader.Geometry.fromLink(t.geometry,n);return r===null?(n.log.write("Geometry instance has no geometry, mesh ignored",3),null):e.Converter.Geometry.createGeometry(r,t.materials,n)},t.createAnimated=function(t,n){var r=e.Loader.Controller.fromLink(t.controller,n);return r===null?(n.log.write("Controller instance has no controller, mesh ignored",3),null):r.skin!==null?e.Converter.Geometry.createSkin(t,r,n):r.morph!==null?e.Converter.Geometry.createMorph(t,r,n):null},t.createSkin=function(t,n,r){var n=e.Loader.Controller.fromLink(t.controller,r);if(n===null)return r.log.write("Controller instance has no controller, mesh ignored",4),null;var i=n.skin;if(i===null)return r.log.write("Controller has no skin, mesh ignored",4),null;var s=e.Loader.Geometry.fromLink(i.source,r);if(s===null)return r.log.write("Controller has no geometry, mesh ignored",4),null;var o=e.Converter.Geometry.createGeometry(s,t.materials,r),u=t.skeletons,a=[];for(var f=0;f<u.length;f++){var l=u[f],c=e.Loader.VisualSceneNode.fromLink(l,r);if(c===null){r.log.write("Skeleton root node "+l.getUrl()+" not found, skeleton root ignored",3);continue}a.push(c)}a.length===0&&(r.log.write("Controller has no skeleton, using the whole scene as the skeleton root",3),a=r.nodes.collada.filter(function(t){return t.parent instanceof e.Loader.VisualScene}));if(a.length===0)return r.log.write("Controller still has no skeleton, using unskinned geometry",3),o;var h=i.joints;if(h===null)return r.log.write("Skin has no joints element, using unskinned mesh",3),o;var p=h.joints;if(p===null)return r.log.write("Skin has no joints input, using unskinned mesh",3),o;var d=e.Loader.Source.fromLink(p.source,r);if(d===null)return r.log.write("Skin has no joints source, using unskinned mesh",3),o;var v=d.data,m=null;i.bindShapeMatrix!==null&&(m=mat4.create(),e.MathUtils.mat4Extract(i.bindShapeMatrix,0,m));var g=h.invBindMatrices;if(g===null)return r.log.write("Skin has no inverse bind matrix input, using unskinned mesh",3),o;var y=e.Loader.Source.fromLink(g.source,r);if(d===null)return r.log.write("Skin has no inverse bind matrix source, using unskinned mesh",3),o;if(y.data.length!==d.data.length*16)return r.log.write("Skin has an inconsistent length of joint data sources, using unskinned mesh",3),o;if(y.data instanceof Float32Array){var b=y.data,w=i.vertexWeights;if(w===null)return r.log.write("Skin contains no bone weights element, using unskinned mesh",3),o;var E=w.weights;if(E===null)return r.log.write("Skin contains no bone weights input, using unskinned mesh",3),o;var S=e.Loader.Source.fromLink(E.source,r);if(S===null)return r.log.write("Skin has no bone weights source, using unskinned mesh",3),o;if(S.data instanceof Float32Array){var x=S.data;if(i.vertexWeights.joints.source.url!==i.joints.joints.source.url)return r.log.write("Skin uses different data sources for joints in <joints> and <vertex_weights>, this is not supported. Using unskinned mesh.",3),o;var T=e.Converter.Bone.createSkinBones(v,a,m,b,r);if(T===null||T.length===0)return r.log.write("Skin contains no bones, using unskinned mesh",3),o;var N=4,C=i.vertexWeights.v,k=i.vertexWeights.vcount,L=k.length,A=new Float32Array(L*N),O=new Uint8Array(L*N),M=0,_=0,D=0;for(var f=0;f<L;++f){var P=k[f],H=0;for(var B=0;B<P;++B){var j=C[M],F=C[M+1];M+=2;var I=x[F];B<N&&(H+=I,O[f*N+B]=j,A[f*N+B]=I)}P>N&&_++;if(H<1e-6||H>1e6)D++;else for(var B=0;B<P;++B)A[f*N+B]/=H}_>0&&r.log.write(""+_+" vertices are influenced by too many bones, some influences were ignored. Only "+N+" bones per vertex are supported.",3),D>0&&r.log.write(""+D+" vertices have zero or infinite total weight, skin will be broken.",3);for(var f=0;f<o.chunks.length;++f){var q=o.chunks[f];q.boneindex=new Uint8Array(q.vertexCount*N),e.Converter.Utils.reIndex(O,q._colladaVertexIndices,q._colladaIndexStride,q._colladaIndexOffset,N,q.boneindex,q.indices,1,0,N),q.boneweight=new Float32Array(q.vertexCount*N),e.Converter.Utils.reIndex(A,q._colladaVertexIndices,q._colladaIndexStride,q._colladaIndexOffset,N,q.boneweight,q.indices,1,0,N)}for(var f=0;f<o.chunks.length;++f){var q=o.chunks[f];q.bindShapeMatrix=mat4.clone(m)}return o.bones=T,o}return r.log.write("Bone weights data does not contain floating point data, using unskinned mesh",3),o}return r.log.write("Skin inverse bind matrices data does not contain floating point data, using unskinned mesh",3),o},t.createMorph=function(e,t,n){return n.log.write("Morph animated meshes not supported, mesh ignored",3),null},t.createGeometry=function(t,n,r){var i=e.Converter.Material.getMaterialMap(n,r),s=new e.Converter.Geometry;s.name=t.name||t.id||t.sid||"geometry";var o=t.triangles;for(var u=0;u<o.length;u++){var a=o[u],f;a.material!==null?(f=i.symbols[a.material],f===null&&(r.log.write("Material symbol "+a.material+" has no bound material instance, using default material",3),f=e.Converter.Material.createDefaultMaterial(r))):(r.log.write("Missing material index, using default material",3),f=e.Converter.Material.createDefaultMaterial(r));var l=e.Converter.Geometry.createChunk(t,a,r);l!==null&&(l.name=t.name,o.length>1&&(l.name+=" #"+u),l.material=f,s.chunks.push(l))}return s},t.createChunk=function(t,n,r){var i=null,s=null,o=null,u=[];for(var a=0;a<n.inputs.length;a++){var f=n.inputs[a];switch(f.semantic){case"VERTEX":i=f;break;case"NORMAL":s=f;break;case"COLOR":o=f;break;case"TEXCOORD":u.push(f);break;default:r.log.write("Unknown triangles input semantic "+f.semantic+" ignored",3)}}var l=e.Loader.Vertices.fromLink(i.source,r);if(l===null)return r.log.write("Geometry "+t.id+" has no vertices, geometry ignored",3),null;var c=e.Loader.Source.fromLink(s!=null?s.source:null,r),h=e.Loader.Source.fromLink(o!=null?o.source:null,r),p=u.map(function(t){return e.Loader.Source.fromLink(t!=null?t.source:null,r)}),d=null,v=null,m=null,g=[];for(var a=0;a<l.inputs.length;a++){var f=l.inputs[a];switch(f.semantic){case"POSITION":d=f;break;case"NORMAL":v=f;break;case"COLOR":m=f;break;case"TEXCOORD":g.push(f);break;default:r.log.write("Unknown vertices input semantic "+f.semantic+" ignored",3)}}var y=e.Loader.Source.fromLink(d.source,r);if(y===null)return r.log.write("Geometry "+t.id+" has no vertex positions, geometry ignored",3),null;var b=e.Loader.Source.fromLink(v!=null?v.source:null,r),w=e.Loader.Source.fromLink(m!=null?m.source:null,r),E=g.map(function(t){return e.Loader.Source.fromLink(t!=null?t.source:null,r)}),S=e.Converter.Utils.createFloatArray(y,"vertex position",3,r),x=e.Converter.Utils.createFloatArray(b,"vertex normal",3,r),T=e.Converter.Utils.createFloatArray(c,"vertex normal (indexed)",3,r),N=e.Converter.Utils.createFloatArray(w,"vertex color",4,r),C=e.Converter.Utils.createFloatArray(h,"vertex color (indexed)",4,r),k=E.map(function(t){return e.Converter.Utils.createFloatArray(t,"texture coordinate",2,r)}),L=p.map(function(t){return e.Converter.Utils.createFloatArray(t,"texture coordinate (indexed)",2,r)});if(n.type!=="triangles"){var A=n.vcount;for(var a=0;a<A.length;a++){var O=A[a];if(O!==3)return r.log.write("Geometry "+t.id+" has non-triangle polygons, geometry ignored",3),null}}if(y.stride!==3)return r.log.write("Geometry "+t.id+" vertex positions are not 3D vectors, geometry ignored",3),null;var M=n.indices,_=n.count,D=M.length/n.count,P=D/3,H=e.Converter.Utils.compactIndices(M,P,i.offset);if(H===null||H.length===0)return r.log.write("Geometry "+t.id+" does not contain any indices, geometry ignored",4),null;var B=e.Converter.Utils.maxIndex(H)+1,j=H.length/3;if(j!==_)return r.log.write("Geometry "+t.id+" has an inconsistent number of indices, geometry ignored",4),null;var F=new Float32Array(B*3),I=i.offset;e.Converter.Utils.reIndex(S,M,P,I,3,F,H,1,0,3);var q=new Float32Array(B*3),R=s!==null?s.offset:null;x!==null?e.Converter.Utils.reIndex(x,M,P,I,3,q,H,1,0,3):T!==null?e.Converter.Utils.reIndex(T,M,P,R,3,q,H,1,0,3):r.log.write("Geometry "+t.id+" has no normal data, using zero vectors",3);var U=new Float32Array(B*2),z=u.length>0?u[0].offset:null;k.length>0?e.Converter.Utils.reIndex(k[0],M,P,I,2,U,H,1,0,2):L.length>0?e.Converter.Utils.reIndex(L[0],M,P,z,2,U,H,1,0,2):r.log.write("Geometry "+t.id+" has no texture coordinate data, using zero vectors",3);var W=new e.Converter.GeometryChunk;return W.vertexCount=B,W.triangleCount=j,W.indices=H,W.position=F,W.normal=q,W.texcoord=U,W._colladaVertexIndices=M,W._colladaIndexStride=P,W._colladaIndexOffset=I,e.Converter.Geometry.computeBoundingBox(W,r),W},t.computeBoundingBox=function(e,t){var n=e.bbox_max,r=e.bbox_min,i=e.position;vec3.set(r,Infinity,Infinity,Infinity),vec3.set(n,-Infinity,-Infinity,-Infinity);var s=vec3.create();for(var o=0;o<i.length/3;++o)s[0]=i[o*3+0],s[1]=i[o*3+1],s[2]=i[o*3+2],vec3.max(n,n,s),vec3.min(r,r,s)},t.transformGeometry=function(e,t,n){var r=mat3.create();mat3.normalFromMat4(r,t);for(var i=0;i<e.chunks.length;++i){var s=e.chunks[i];s.position!==null&&vec3.forEach(s.position,3,0,s.position.length/3,vec3.transformMat4,t),s.normal!==null&&vec3.forEach(s.normal,3,0,s.normal.length/3,vec3.transformMat3,r)}},t.addSkeleton=function(t,n,r){var i=r.nodes.findCollada(n),s=e.Converter.Bone.create(n);mat4.identity(s.invBindMatrix),t.bones.push(s),e.Converter.Bone.updateIndices(t.bones);for(var o=0;o<t.chunks.length;++o){var u=t.chunks[o];u.boneindex=new Uint8Array(u.vertexCount*4),u.boneweight=new Float32Array(u.vertexCount*4);for(var a=0;a<u.vertexCount;++a)u.boneindex[4*a+0]=0,u.boneindex[4*a+1]=0,u.boneindex[4*a+2]=0,u.boneindex[4*a+3]=0,u.boneweight[4*a+0]=1,u.boneweight[4*a+1]=0,u.boneweight[4*a+2]=0,u.boneweight[4*a+3]=0}},t.mergeGeometries=function(t,n){if(t.length===1)return t[0];var r=new e.Converter.Geometry;r.name="merged_geometry";var i=[];for(var s=0;s<t.length;++s)e.Converter.Bone.appendBones(i,t[s].bones);r.bones=i;for(var s=0;s<t.length;++s)e.Converter.Geometry.adaptBoneIndices(t[s],i,n);e.Converter.Bone.updateIndices(i);for(var s=0;s<i.length;++s){var o=i[s];if(o.parent!==null&&o.parent!=i[o.parentIndex()])throw new Error("Inconsistent bone parent")}for(var s=0;s<t.length;++s)r.chunks=r.chunks.concat(t[s].chunks);for(var s=0;s<t.length;++s)t[s].chunks=[],t[s].bones=[];return r},t.adaptBoneIndices=function(t,n,r){if(t.bones.length===0)return;var i=e.Converter.Bone.getBoneIndexMap(t.bones,n);for(var s=0;s<t.chunks.length;++s){var o=t.chunks[s],u=o.boneindex;for(var a=0;a<u.length;++a)u[a]=i[u[a]]}},t}();t.Geometry=r})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function e(){this.minTime=Infinity,this.maxTime=-Infinity,this.minAvgFps=Infinity,this.maxAvgFps=-Infinity,this.sumAvgFps=0,this.count=0}return e.prototype.avgFps=function(){return this.count>0?this.sumAvgFps/this.count:null},e.prototype.addDataPoint=function(e,t,n){this.count++,this.minTime=Math.min(this.minTime,e),this.maxTime=Math.max(this.maxTime,t),this.minAvgFps=Math.min(this.minAvgFps,n),this.maxAvgFps=Math.max(this.maxAvgFps,n),this.sumAvgFps+=n},e}();t.AnimationTimeStatistics=n;var r=function(){function t(){this.id=null,this.name=null,this.channels=[]}return t.create=function(t,n){var r=new e.Converter.Animation;return r.id=t.id,r.name=t.name,e.Converter.Animation.addChannelsToAnimation(t,r,n),r},t.addChannelsToAnimation=function(t,n,r){for(var i=0;i<t.channels.length;++i){var s=e.Converter.AnimationChannel.create(t.channels[i],r);n.channels.push(s)}for(var i=0;i<t.
children.length;++i){var o=t.children[i];e.Converter.Animation.addChannelsToAnimation(o,n,r)}},t.getTimeStatistics=function(e,t,n,r,i){for(var s=0;s<e.channels.length;++s){var o=e.channels[s],u=o.input[t!==null?t:0],a=o.input[n!==null?n:o.input.length-1],f=o.input.length/(a-u);r.addDataPoint(u,a,f)}},t}();t.Animation=r})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.target=null,this.interpolation=null,this.input=null,this.output=null,this.inTangent=null,this.outTangent=null,this.dataOffset=null,this.dataCount=null}return t.prototype.findInputIndices=function(e,t){var n=this.input;if(e<n[0])return t.log.write("Invalid time for resampling: t="+e+", t_begin="+n[0]+", using first keyframe",3),{i0:0,i1:1};if(e>n[n.length-1])return t.log.write("Invalid time for resampling: t="+e+", t_end="+n[n.length-1]+", using last keyframe",3),{i0:n.length-2,i1:n.length-1};for(var r=0;r<n.length-1;++r){var i=n[r],s=n[r+1];if(i<=e&&e<=s)return{i0:r,i1:r+1}}return t.log.write("Keyframes for time "+e+"not found, using first keyframe",3),{i0:0,i1:1}},t.createInputData=function(t,n,r,i){if(t===null)return null;var s=e.Loader.Source.fromLink(t.source,i);return s===null?(i.log.write("Animation channel has no "+n+" input data, data ignored",3),null):r!=s.stride?(i.log.write("Animation channel has a nonstandard dimensionality for "+n+", data ignored",3),null):e.Converter.Utils.createFloatArray(s,n,r,i)},t.createInputDataFromArray=function(t,n,r,i){return t.length>0?(t.length>1&&i.log.write("Animation channel has more than one "+n+" input, using only the first one",3),e.Converter.AnimationChannel.createInputData(t[0],n,r,i)):null},t.create=function(t,n){var r=new e.Converter.AnimationChannel,i=e.Loader.Element.fromLink(t.target,n);if(i===null)return n.log.write("Animation channel has an invalid target '"+t.target.url+"', animation ignored",3),null;var s=n.animationTargets.findConverter(i);if(s===null)return n.log.write("Animation channel has no converter target '"+t.target.url+"', animation ignored",3),null;r.target=s;var o=e.Loader.Sampler.fromLink(t.source,n);if(o===null)return n.log.write("Animation channel has an invalid sampler '"+t.source.url+"', animation ignored",3),null;var u=s.getTargetDataRows(),a=s.getTargetDataColumns(),f=u*a,l=t.target;if(l.dotSyntax){r.dataCount=1;switch(l.member){case"X":r.dataOffset=0;break;case"Y":r.dataOffset=1;break;case"Z":r.dataOffset=2;break;case"W":r.dataOffset=3;break;case"R":r.dataOffset=0;break;case"G":r.dataOffset=1;break;case"B":r.dataOffset=2;break;case"U":r.dataOffset=0;break;case"V":r.dataOffset=1;break;case"S":r.dataOffset=0;break;case"T":r.dataOffset=1;break;case"P":r.dataOffset=2;break;case"Q":r.dataOffset=3;break;case"ANGLE":r.dataOffset=3;break;default:return n.log.write("Unknown semantic for '"+l.url+"', animation ignored",3),null}}else if(t.target.arrSyntax){r.dataCount=1;switch(l.indices.length){case 1:r.dataOffset=l.indices[0];break;case 2:r.dataOffset=l.indices[0]*u+l.indices[1];break;default:return n.log.write("Invalid number of indices for '"+l.url+"', animation ignored",3),null}}else r.dataOffset=0,r.dataCount=a*u;r.input=e.Converter.AnimationChannel.createInputData(o.input,"input",1,n),r.output=e.Converter.AnimationChannel.createInputDataFromArray(o.outputs,"output",r.dataCount,n),r.inTangent=e.Converter.AnimationChannel.createInputDataFromArray(o.inTangents,"intangent",r.dataCount+1,n),r.outTangent=e.Converter.AnimationChannel.createInputDataFromArray(o.outTangents,"outtangent",r.dataCount+1,n);if(r.input===null)return n.log.write("Animation channel has no input data, animation ignored",3),null;if(r.output===null)return n.log.write("Animation channel has no output data, animation ignored",3),null;var c=o.interpolation;if(c===null)return n.log.write("Animation channel has no interpolation input, animation ignored",3),null;var h=e.Loader.Source.fromLink(c.source,n);return h===null?(n.log.write("Animation channel has no interpolation source, animation ignored",3),null):(r.interpolation=e.Converter.Utils.createStringArray(h,"interpolation type",1,n),s.registerAnimation(r),r)},t.interpolateLinear=function(e,t,n,r,i,s,o,u,a){var f=(e-t)/(n-t);for(var l=0;l<s;++l){var c=u.output[r*s+l],h=u.output[i*s+l];a[o+l]=c+f*(h-c)}},t.interpolateBezier=function(t,n,r,i,s,o,u,a,f){var l=a.outTangent[i*(o+1)],c=a.inTangent[s*(o+1)],h=Math.abs(r-n)*1e-4,p=e.MathUtils.bisect(t,function(t){return e.MathUtils.bezier(n,l,c,r,t)},h,100),d=Math.abs(t-e.MathUtils.bezier(n,l,c,r,p));for(var v=0;v<o;++v){var m=a.output[i*o+v],g=a.output[s*o+v],y=a.outTangent[i*(o+1)+v+1],b=a.inTangent[s*(o+1)+v+1];f[u+v]=e.MathUtils.bezier(m,y,b,g,p)}},t.interpolateHermite=function(t,n,r,i,s,o,u,a,f){var l=a.outTangent[i*(o+1)],c=a.inTangent[s*(o+1)],h=Math.abs(r-n)*1e-5,p=e.MathUtils.bisect(t,function(t){return e.MathUtils.hermite(n,l,c,r,t)},h,100);for(var d=0;d<o;++d){var v=a.output[i*o+d],m=a.output[s*o+d],n=a.outTangent[i*(o+1)+d+1],r=a.inTangent[s*(o+1)+d+1];f[u+d]=e.MathUtils.hermite(v,n,r,m,p)}},t.applyToData=function(t,n,r,i){if(t.input===null||t.output===null)return;var s=t.findInputIndices(r,i),o=s.i0,u=s.i1,a=t.input[o],f=t.input[u],l=t.dataCount,c=t.dataOffset,h=t.interpolation[s.i0];switch(h){case"STEP":for(var p=0;p<l;++p)n[c+p]=t.output[o*l+p];break;case"LINEAR":e.Converter.AnimationChannel.interpolateLinear(r,a,f,o,u,l,c,t,n);break;case"BEZIER":t.inTangent!==null&&t.outTangent!==null?e.Converter.AnimationChannel.interpolateBezier(r,a,f,o,u,l,c,t,n):e.Converter.AnimationChannel.interpolateLinear(r,a,f,o,u,l,c,t,n);break;case"HERMITE":t.inTangent!==null&&t.outTangent!==null?e.Converter.AnimationChannel.interpolateHermite(r,a,f,o,u,l,c,t,n):e.Converter.AnimationChannel.interpolateLinear(r,a,f,o,u,l,c,t,n);break;case"CARDINAL":case"BSPLINE":i.log.write("Interpolation type "+h+" not supported, using STEP",3);for(var p=0;p<l;++p)n[c+p]=t.input[o*l+p];break;default:i.log.write("Unknown interpolation type "+h+" at time "+r+", using STEP",3);for(var p=0;p<l;++p)n[c+p]=t.input[o*l+p]}},t}();t.AnimationChannel=n})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){(function(e){e[e.Translation=1]="Translation",e[e.Rotation=2]="Rotation",e[e.Scale=3]="Scale"})(t.TransformType||(t.TransformType={}));var n=t.TransformType,r=function(){function t(e,t,n){this.rows=t,this.colums=n,this.channels=[];var r=t*n;this.data=new Float32Array(r),this.original_data=new Float32Array(r);for(var i=0;i<r;++i)this.data[i]=e.data[i],this.original_data[i]=e.data[i]}return t.prototype.getTargetDataRows=function(){return this.rows},t.prototype.getTargetDataColumns=function(){return this.colums},t.prototype.applyAnimation=function(t,n,r){e.Converter.AnimationChannel.applyToData(t,this.data,n,r),this.updateFromData()},t.prototype.registerAnimation=function(e){this.channels.push(e)},t.prototype.isAnimated=function(){return this.channels.length>0},t.prototype.isAnimatedBy=function(e){if(e!==null){for(var t=0;t<this.channels.length;++t){var n=this.channels[t];if(e.channels.indexOf(n)!==-1)return!0}return!1}return this.channels.length>0},t.prototype.resetAnimation=function(){for(var e=0;e<this.data.length;++e)this.data[e]=this.original_data[e];this.updateFromData()},t.prototype.applyTransformation=function(e){throw new Error("Not implemented")},t.prototype.updateFromData=function(){throw new Error("Not implemented")},t.prototype.hasTransformType=function(e){throw new Error("Not implemented")},t}();t.Transform=r;var i=function(t){function n(e){t.call(this,e,4,4),this.matrix=mat4.create(),this.updateFromData()}return __extends(n,t),n.prototype.updateFromData=function(){e.MathUtils.mat4Extract(this.data,0,this.matrix)},n.prototype.applyTransformation=function(e){mat4.multiply(e,e,this.matrix)},n.prototype.hasTransformType=function(e){return!0},n}(r);t.TransformMatrix=i;var s=function(e){function t(t){e.call(this,t,4,1),this.axis=vec3.create(),this.radians=0,this.updateFromData()}return __extends(t,e),t.prototype.updateFromData=function(){vec3.set(this.axis,this.data[0],this.data[1],this.data[2]),this.radians=this.data[3]/180*Math.PI},t.prototype.applyTransformation=function(e){mat4.rotate(e,e,this.radians,this.axis)},t.prototype.hasTransformType=function(e){return e===2},t}(r);t.TransformRotate=s;var o=function(e){function t(t){e.call(this,t,3,1),this.pos=vec3.create(),this.updateFromData()}return __extends(t,e),t.prototype.updateFromData=function(){vec3.set(this.pos,this.data[0],this.data[1],this.data[2])},t.prototype.applyTransformation=function(e){mat4.translate(e,e,this.pos)},t.prototype.hasTransformType=function(e){return e===1},t}(r);t.TransformTranslate=o;var u=function(e){function t(t){e.call(this,t,3,1),this.scl=vec3.create(),this.updateFromData()}return __extends(t,e),t.prototype.updateFromData=function(){vec3.set(this.scl,this.data[0],this.data[1],this.data[2])},t.prototype.applyTransformation=function(e){mat4.scale(e,e,this.scl)},t.prototype.hasTransformType=function(e){return e===3},t}(r);t.TransformScale=u})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.name="",this.parent=null,this.children=[],this.geometries=[],this.transformations=[],this.matrix=mat4.create(),this.worldMatrix=mat4.create()}return t.prototype.getWorldMatrix=function(){return this.parent!=null?mat4.multiply(this.worldMatrix,this.parent.getWorldMatrix(),this.getLocalMatrix()):mat4.copy(this.worldMatrix,this.getLocalMatrix()),this.worldMatrix},t.prototype.getLocalMatrix=function(){mat4.identity(this.matrix);for(var e=0;e<this.transformations.length;e++){var t=this.transformations[e];t.applyTransformation(this.matrix)}return this.matrix},t.prototype.containsSceneGraphItems=function(){return this.geometries.length>0?!0:!1},t.prototype.isAnimated=function(e){return this.isAnimatedBy(null,e)},t.prototype.isAnimatedBy=function(e,t){for(var n=0;n<this.transformations.length;n++){var r=this.transformations[n];if(r.isAnimatedBy(e))return!0}return t&&this.parent!==null?this.parent.isAnimatedBy(e,t):!1},t.prototype.resetAnimation=function(){for(var e=0;e<this.transformations.length;e++){var t=this.transformations[e];t.resetAnimation()}},t.pruneNodes=function(t,n){for(var r=0;r<t.length;++r){var i=t[r];e.Converter.Node.pruneNodes(i.children,n)}t=t.filter(function(e,t,n){return e.containsSceneGraphItems()||e.children.length>0})},t.createNode=function(t,n){var r=new e.Converter.Node;n.nodes.register(t,r),r.name=t.name||t.id||t.sid||"Unnamed node";for(var i=0;i<t.transformations.length;++i){var s=t.transformations[i],o=null;switch(s.type){case"matrix":o=new e.Converter.TransformMatrix(s);break;case"rotate":o=new e.Converter.TransformRotate(s);break;case"translate":o=new e.Converter.TransformTranslate(s);break;case"scale":o=new e.Converter.TransformScale(s);break;default:n.log.write("Transformation type "+s.type+" not supported, transform ignored",3)}o!==null&&(n.animationTargets.register(s,o),r.transformations.push(o))}r.getLocalMatrix();for(var i=0;i<t.children.length;i++){var u=t.children[i],a=e.Converter.Node.createNode(u,n);a.parent=r,r.children.push(a)}return r},t.createNodeData=function(t,n){var r=n.nodes.findCollada(t);for(var i=0;i<r.geometries.length;i++){var s=r.geometries[i],o=e.Converter.Geometry.createStatic(s,n);t.geometries.push(o)}for(var i=0;i<r.controllers.length;i++){var u=r.controllers[i],o=e.Converter.Geometry.createAnimated(u,n);t.geometries.push(o)}r.lights.length>0&&n.log.write("Node "+r.id+" contains lights, lights are ignored",3),r.cameras.length>0&&n.log.write("Node "+r.id+" contains cameras, cameras are ignored",3);for(var i=0;i<t.children.length;i++){var a=t.children[i];e.Converter.Node.createNodeData(a,n)}},t.forEachNode=function(t,n){for(var r=0;r<t.length;++r){var i=t[r];n(i),e.Converter.Node.forEachNode(i.children,n)}},t.extractGeometries=function(t,n){var r=[],i=[];e.Converter.Node.forEachNode(t,function(e){for(var t=0;t<e.geometries.length;++t)r.push(e),i.push(e.geometries[t]),e.geometries=[]});if(i.length===0){n.log.write("No geometry found in the scene, returning an empty geometry",3);var s=new e.Converter.Geometry;return s.name="empty_geometry",[s]}for(var o=0;o<i.length;++o){var s=i[o],u=r[o],a=s.bones.length===0&&!u.isAnimated(!0);a&&e.Converter.Geometry.transformGeometry(s,u.getWorldMatrix(),n)}if(n.options.singleGeometry){var s=e.Converter.Geometry.mergeGeometries(i,n);i=[s]}return i},t}();t.Node=n})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(e){this.id=e.id,this.url=""}return t.createTexture=function(t,n){if(t===null)return null;if(t.textureSampler===null)return null;var r=e.Loader.EffectParam.fromLink(t.textureSampler,n);if(r===null)return n.log.write("Texture sampler not found, texture will be missing",3),null;var i=r.sampler;if(i===null)return n.log.write("Texture sampler param has no sampler, texture will be missing",3),null;var s=null;if(i.image!=null){s=e.Loader.Image.fromLink(i.image,n);if(s===null)return n.log.write("Texture image not found, texture will be missing",3),null}else if(i.surface!=null){var o=e.Loader.EffectParam.fromLink(i.surface,n);if(o===null)return n.log.write("Texture surface not found, texture will be missing",3),null;var u=o.surface;if(u===null)return n.log.write("Texture surface param has no surface, texture will be missing",3),null;s=e.Loader.Image.fromLink(u.initFrom,n);if(s===null)return n.log.write("Texture image not found, texture will be missing",3),null}var a=n.textures.findConverter(s);return a?a:(a=new e.Converter.Texture(s),a.url=s.initFrom,n.textures.register(s,a),a)},t}();t.Texture=n})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function e(){this.collada=[],this.converter=[]}return e.prototype.register=function(e,t){this.collada.push(e),this.converter.push(t)},e.prototype.findConverter=function(e){for(var t=0;t<this.collada.length;++t)if(this.collada[t]===e)return this.converter[t];return null},e.prototype.findCollada=function(e){for(var t=0;t<this.collada.length;++t)if(this.converter[t]===e)return this.collada[t];return null},e}();t.ObjectMap=n;var r=function(){function t(t,n){this.log=t,this.options=n,this.materials=new e.Converter.ObjectMap,this.textures=new e.Converter.ObjectMap,this.nodes=new e.Converter.ObjectMap,this.animationTargets=new e.Converter.ObjectMap}return t}();t.Context=r})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(e){var t=function(){function e(e,t){this.value=e,this.description=t}return e}();e.OptionBool=t;var n=function(){function e(e,t,n,r){this.value=e,this.min=t,this.max=n,this.description=r}return e}();e.OptionFloat=n;var r=function(){function e(e,t){this.value=e,this.description=t}return e}();e.OptionArray=r;var i=function(){function e(){this.singleAnimation=new t(!0,"If enabled, all animations are merged into a single animation. Enable if each bone has a separate top level animation."),this.singleGeometry=new t(!0,"If enabled, all geometries are merged into a single geometry. Only has an effect if 'extractGeometry' is enabled."),this.enableAnimations=new t(!0,"If enabled, animations are exported. Otherwise, all animations are ignored."),this.enableExtractGeometry=new t(!0,"If enabled, extracts all geometries from the scene and detaches them from their scene graph nodes. Otherwise, geometries remain attached to nodes."),this.enableResampledAnimations=new t(!0,"If enabled, generates resampled animations for all skeleton bones."),this.useAnimationLabels=new t(!1,"If enabled, animations labels are used to split the global animation into separete animations."),this.animationLabels=new r([],"An array of animation labels ({name, begin, end, fps)} that describes how the global animation is split. Only has an effect if 'useAnimationLabels' is enabled."),this.animationFps=new n(10,0,100,"Default FPS for resampled animations."),this.removeConstAnimationTracks=new t(!0,"If enabled, animation tracks are removed if they only contain the rest pose transformation for all times.")}return e}();e.Options=i})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function e(){this.pos=null,this.rot=null,this.scl=null,this.rel_pos=null,this.rel_rot=null,this.rel_scl=null}return e}();t.AnimationDataTrack=n;var r=function(){function t(){this.name="",this.duration=null,this.keyframes=null,this.fps=null,this.tracks=[]}return t.create=function(t,n,r,i,s,o){var u=new e.Converter.AnimationData;u.name=n.name;var a=n.channels,f=new e.Converter.AnimationTimeStatistics;e.Converter.Animation.getTimeStatistics(n,r,i,f,o),s===null&&(s=f.avgFps());if(s===null||s<=0)return o.log.write("Could not determine FPS for animation, skipping animation",3),null;var l=f.minTime,c=f.maxTime,h=c-l,p=Math.ceil(s*h)+1;s=(p-1)/h;var d=1/s;u.fps=s,u.keyframes=p,u.duration=h,s>0||o.log.write("Invalid FPS: "+s+", skipping animation",3),h>0||o.log.write("Invalid duration: "+h+", skipping animation",3),p>0||o.log.write("Invalid number of keyframes: "+p+", skipping animation",3);for(var v=0;v<t.length;++v){var m=t[v],g=new e.Converter.AnimationDataTrack;g.pos=new Float32Array(p*3),g.rot=new Float32Array(p*4),g.scl=new Float32Array(p*3),g.rel_pos=new Float32Array(p*3),g.rel_rot=new Float32Array(p*4),g.rel_scl=new Float32Array(p*3),u.tracks.push(g)}var y=u.tracks;for(var v=0;v<t.length;++v){var m=t[v];m.node.resetAnimation()}var b=vec3.create(),w=quat.create(),E=vec3.create();for(var S=0;S<p;++S){var x=l+S*d;for(var T=0;T<a.length;++T){var N=a[T];N.target.applyAnimation(N,x,o)}for(var C=0;C<t.length;++C){var m=t[C],g=y[C],k=m.node.getLocalMatrix();e.MathUtils.decompose(k,b,w,E);var L=mat4.create();mat4.fromRotationTranslation(L,w,b),g.pos!==null&&(g.pos[S*3+0]=b[0],g.pos[S*3+1]=b[1],g.pos[S*3+2]=b[2]),g.rot!==null&&(g.rot[S*4+0]=w[0],g.rot[S*4+1]=w[1],g.rot[S*4+2]=w[2],g.rot[S*4+3]=w[3]),g.scl!==null&&(g.scl[S*3+0]=E[0],g.scl[S*3+1]=E[1],g.scl[S*3+2]=E[2])}}for(var v=0;v<t.length;++v){var m=t[v];m.node.resetAnimation()}var A=!1,O=vec3.create(),M=vec3.create(),_=quat.create(),D=quat.create(),P=vec3.create(),H=vec3.create();for(var C=0;C<t.length;++C){var m=t[C],g=y[C],B=m.node.getLocalMatrix();e.MathUtils.decompose(B,O,_,P),quat.invert(D,_),vec3.negate(M,O),vec3.set(H,1/P[0],1/P[1],1/P[2]);var j=0,F=0,I=0,q=0,R=0,U=0;for(var S=0;S<p;++S)b[0]=g.pos[S*3+0],b[1]=g.pos[S*3+1],b[2]=g.pos[S*3+2],vec3.add(b,M,b),j=vec3.length(b),q=Math.max(q,j),w[0]=g.rot[S*4+0],w[1]=g.rot[S*4+1],w[2]=g.rot[S*4+2],w[3]=g.rot[S*4+3],quat.multiply(w,D,w),F=2*Math.acos(Math.min(Math.max(w[3],-1),1)),R=Math.max(R,F),E[0]=g.scl[S*3+0],E[1]=g.scl[S*3+1],E[2]=g.scl[S*3+2],vec3.multiply(E,H,E),I=Math.max(Math.abs(1-E[0]),Math.abs(1-E[1]),Math.abs(1-E[2])),U=Math.max(U,I),g.rel_pos[S*3+0]=b[0],g.rel_pos[S*3+1]=b[1],g.rel_pos[S*3+2]=b[2],g.rel_scl[S*3+0]=E[0],g.rel_scl[S*3+1]=E[1],g.rel_scl[S*3+2]=E[2],g.rel_rot[S*4+0]=w[0],g.rel_rot[S*4+1]=w[1],g.rel_rot[S*4+2]=w[2],g.rel_rot[S*4+3]=w[3];if(o.options.removeConstAnimationTracks.value===!0){var z=1e-4,W=.05,X=.5;q<z&&(g.pos=null,g.rel_pos=null),R<W&&(g.rot=null,g.rel_rot=null),U<X&&(g.scl=null,g.rel_scl=null)}}return u},t.createFromLabels=function(t,n,r,i){var s=[];for(var o=0;o<r.length;++o){var u=r[o],a=e.Converter.AnimationData.create(t,n,u.begin,u.end,u.fps,i);a!==null&&(a.name=u.name,s.push(a))}return s},t}();t.AnimationData=r})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(e){var t=function(){function e(){this.nodes=[],this.animations=[],this.geometries=[],this.resampled_animations=[]}return e}();e.Document=t})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.log=new e.LogConsole,this.options=new e.Converter.Options}return t.prototype.convert=function(n){var r=new e.Converter.Context(this.log,this.options),i=new e.Converter.Document;return i.nodes=t.createScene(n,r),r.options.enableExtractGeometry.value===!0&&(i.geometries=e.Converter.Node.extractGeometries(i.nodes,r)),r.options.enableAnimations.value===!0&&(i.animations=t.createAnimations(n,r)),r.options.enableResampledAnimations.value===!0&&(i.resampled_animations=t.createResampledAnimations(n,i,r)),i},t.createScene=function(t,n){var r=[],i=e.Loader.VisualScene.fromLink(t.scene.instance,n);if(i===null)return n.log.write("Collada document has no scene",3),r;for(var s=0;s<i.children.length;++s){var o=i.children[s];r.push(e.Converter.Node.createNode(o,n))}for(var s=0;s<r.length;++s){var u=r[s];e.Converter.Node.createNodeData(u,n)}return r},t.createAnimations=function(t,n){var r=[];for(var i=0;i<t.libAnimations.children.length;++i){var s=t.libAnimations.children[i];r.push(e.Converter.Animation.create(s,n))}if(n.options.singleAnimation.value===!0&&r.length>1){var o=new e.Converter.Animation;o.id="",o.name="animation";for(var i=0;i<r.length;++i){var u=r[i];o.channels=o.channels.concat(u.channels),u.channels=[]}r=[o]}return r},t.createResampledAnimations=function(t,n,r){var i=[];if(n.animations.length===0)return[];if(n.geometries.length>1)return r.log.write("Converted document contains multiple geometries, resampled animations are only generated for single geometries.",3),[];if(n.geometries.length===0)return r.log.write("Converted document does not contain any geometries, no resampled animations generated.",3),[];var s=n.geometries[0],o=r.options.animationLabels.value,u=r.options.animationFps.value;for(var a=0;a<n.animations.length;++a){var f=n.animations[a];if(r.options.useAnimationLabels.value===!0){var l=e.Converter.AnimationData.createFromLabels(s.bones,f,o,r);i=i.concat(l)}else{var c=e.Converter.AnimationData.create(s.bones,f,null,null,u,r);c!==null&&i.push(c)}}return i},t}();t.ColladaConverter=n})(e.Converter||(e.Converter={}));var t=e.Converter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(e){})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){}return t.stringToBuffer=function(e){var t=atob(e),n=new Uint8Array(t.length);for(var r=0,i=t.length;r<i;++r)n[r]=t.charCodeAt(r);return n},t.bufferToString=function(e){var t="";for(var n=0,r=e.length;n<r;++n)t+=String.fromCharCode(e[n]);return btoa(t)},t.bufferToDataURI=function(t,n){var r=e.Exporter.Utils.bufferToString(t);return n||(n="application/octet-stream"),"data:"+n+";base64,"+r},t.bufferToBlobURI=function(e){var t=new Blob([e]);return URL.createObjectURL(t)},t.jsonToDataURI=function(e,t){var n=JSON.stringify(e);return t||(t="application/json"),"data:"+t+","+n},t}();t.Utils=n})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(e){var t=function(){function e(){this.json=null,this.data=null}return e}();e.Document=t})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.data=null,this.stride=null,this.count=null,this.byte_offset=null,this.bytes_per_element=null}return t.prototype.getDataView=function(){return new Uint8Array(this.data.buffer,0,this.stride*this.count*this.bytes_per_element)},t.prototype.getBytesCount=function(){return this.data.length*this.bytes_per_element},t.prototype.toJSON=function(){var e={type:this.type,byte_offset:this.byte_offset,stride:this.stride,count:this.count};return e},t.create=function(t,n,r){if(t===null)return null;var i=new e.Exporter.DataChunk;i.data=t,i.stride=n,i.count=t.length/n;if(t instanceof Float32Array)i.type="float",i.bytes_per_element=4;else if(t instanceof Float64Array)i.type="double",i.bytes_per_element=8;else if(t instanceof Uint8Array)i.type="uint8",i.bytes_per_element=1;else if(t instanceof Uint16Array)i.type="uint16",i.bytes_per_element=2;else if(t instanceof Uint32Array)i.type="uint32",i.bytes_per_element=4;else if(t instanceof Int8Array)i.type="int8",i.bytes_per_element=1;else if(t instanceof Int16Array)i.type="int16",i.bytes_per_element=2;else{if(!(t instanceof Int32Array))return r.log.write("Unknown data type, data chunk ignored",3),null;i.type="int32",i.bytes_per_element=4}return r.registerChunk(i),i},t}();t.DataChunk=n})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(e){var t=function(){function e(e){this.log=e,this.chunks=[],this.bytes_written=0}return e.prototype.registerChunk=function(e){this.chunks.push(e),e.byte_offset=this.bytes_written,this.bytes_written+=e.getBytesCount()},e.prototype.assembleData=function(){var e=new ArrayBuffer(this.bytes_written),t=new Uint8Array(e);for(var n=0;n<this.chunks.length;++n){var r=this.chunks[n],i=r.getDataView(),s=i.length,o=r.byte_offset;for(var u=0;u<s;++u)t[u+o]=i[u]}return t},e}();e.Context=t})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.name=null,this.diffuse=null,this.specular=null,this.normal=null}return t.create=function(t,n){var r=new e.Exporter.Material;return r.name=t.name||"material",r.diffuse=t.diffuse!==null?t.diffuse.url:null,r.specular=t.specular!==null?t.specular.url:null,r.normal=t.normal!==null?t.normal.url:null,r},t.prototype.toJSON=function(){var e={name:this.name};return this.diffuse!==null&&(e.diffuse=this.diffuse),this.specular!==null&&(e.specular=this.specular),this.normal!==null&&(e.normal=this.normal),e},t}();t.Material=n})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.name=null,this.material=null,this.vertex_count=null,this.triangle_count=null,this.bbox_min=null,this.bbox_max=null,this.bind_shape_mat=null,this.indices=null,this.position=null,this.normal=null,this.texcoord=null,this.boneweight=null,this.boneindex=null}return t.create=function(t,n){var r=new e.Exporter.Geometry;return r.name=t.name,r.material=null,r.vertex_count=t.vertexCount,r.triangle_count=t.triangleCount,r.bbox_min=[t.bbox_min[0],t.bbox_min[1],t.bbox_min[2]],r.bbox_max=[t.bbox_max[0],t.bbox_max[1],t.bbox_max[2]],r.indices=e.Exporter.DataChunk.create(t.indices,3,n),r.position=e.Exporter.DataChunk.create(t.position,3,n),r.normal=e.Exporter.DataChunk.create(t.normal,3,n),r.texcoord=e.Exporter.DataChunk.create(t.texcoord,2,n),r.boneweight=e.Exporter.DataChunk.create(t.boneweight,4,n),r.boneindex=e.Exporter.DataChunk.create(t.boneindex,4,n),t.bindShapeMatrix!==null&&(r.bind_shape_mat=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e.MathUtils.copyNumberArray(t.bindShapeMatrix,r.bind_shape_mat,16)),r},t.prototype.toJSON=function(){var e={name:this.name,material:this.material,vertex_count:this.vertex_count,triangle_count:this.triangle_count,bbox_min:this.bbox_min,bbox_max:this.bbox_max,indices:this.indices.toJSON(),position:this.position.toJSON()};return this.normal!==null&&(e.normal=this.normal.toJSON()),this.texcoord!==null&&(e.texcoord=this.texcoord.toJSON()),this.boneweight!==null&&(e.boneweight=this.boneweight.toJSON()),this.boneindex!==null&&(e.boneindex=this.boneindex.toJSON()),this.bind_shape_mat!==null&&(e.bind_shape_mat=this.bind_shape_mat),e},t}();t.Geometry=n})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.name=null,this.parent=null,this.skinned=null,this.inv_bind_mat=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this.pos=[0,0,0],this.rot=[0,0,0,1],this.scl=[1,1,1]}return t.create=function(t,n){var r=new e.Exporter.Bone;r.name=t.name,r.parent=t.parent!==null?t.parent.index:-1,r.skinned=t.attachedToSkin;var i=t.node.getLocalMatrix();return e.MathUtils.decompose(i,r.pos,r.rot,r.scl),e.MathUtils.copyNumberArray(t.invBindMatrix,r.inv_bind_mat,16),r},t.prototype.toJSON=function(){var t=5,n=4,r=3,i=4;return{name:this.name,parent:this.parent,skinned:this.skinned,inv_bind_mat:this.inv_bind_mat.map(function(n){return e.MathUtils.round(n,t)}),pos:this.pos.map(function(t){return e.MathUtils.round(t,n)}),rot:this.rot.map(function(t){return e.MathUtils.round(t,i)}),scl:this.scl.map(function(t){return e.MathUtils.round(t,r)})}},t}();t.Bone=n})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.pos=null,this.rot=null,this.scl=null,this.bone=null}return t.create=function(t,n,r){var i=new e.Exporter.AnimationTrack;return i.bone=n,i.pos=e.Exporter.DataChunk.create(t.pos,3,r),i.rot=e.Exporter.DataChunk.create(t.rot,4,r),i.scl=e.Exporter.DataChunk.create(t.scl,3,r),i},t.prototype.toJSON=function(){var e={bone:this.bone};return this.pos!==null&&(e.pos=this.pos.toJSON()),this.rot!==null&&(e.rot=this.rot.toJSON()),this.scl!==null&&(e.scl=this.scl.toJSON()),e},t}();t.AnimationTrack=n})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.name=null,this.frames=null,this.fps=null,this.tracks=[]}return t.create=function(t,n){var r=new e.Exporter.Animation;r.name=t.name,r.frames=t.keyframes,r.fps=t.fps;for(var i=0;i<t.tracks.length;++i){var s=t.tracks[i],o=e.Exporter.AnimationTrack.create(s,i,n);r.tracks.push(o)}return r},t.prototype.toJSON=function(){return{name:this.name,frames:this.frames,fps:this.fps,tracks:this.tracks.map(function(e){return e.toJSON()})}},t}();t.Animation=n})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));var COLLADA;(function(e){(function(t){var n=function(){function t(){this.log=new e.LogConsole}return t.prototype.export=function(t){var n=new e.Exporter.Context(this.log),r={bbox_min:[Infinity,Infinity,Infinity],bbox_max:[-Infinity,-Infinity,-Infinity]},i=[],s=[],o=[],u=[],a=[];for(var f=0;f<t.geometries.length;++f){var l=t.geometries[f];for(var c=0;c<l.chunks.length;++c){var h=l.chunks[c],p=i.indexOf(h.material);if(p===-1){var d=e.Exporter.Material.create(h.material,n);p=s.length,i.push(h.material),s.push(d)}var v=e.Exporter.Geometry.create(h,n);v.material=p,o.push(v);for(var m=0;m<3;++m)r.bbox_min[m]=Math.min(r.bbox_min[m],h.bbox_min[m]),r.bbox_max[m]=Math.max(r.bbox_max[m],h.bbox_max[m])}for(var g=0;g<l.bones.length;++g){var y=l.bones[g],b=e.Exporter.Bone.create(y,n);u.push(b)}}for(var w=0;w<t.resampled_animations.length;++w){var E=t.resampled_animations[w],S=e.Exporter.Animation.create(E,n);a.push(S)}var x=new e.Exporter.Document;return x.json={info:r,materials:s.map(function(e){return e.toJSON()}),geometries:o.map(function(e){return e.toJSON()}),bones:u.map(function(e){return e.toJSON()}),animations:a.map(function(e){return e.toJSON()})},x.data=n.assembleData(),x},t}();t.ColladaExporter=n})(e.Exporter||(e.Exporter={}));var t=e.Exporter})(COLLADA||(COLLADA={}));